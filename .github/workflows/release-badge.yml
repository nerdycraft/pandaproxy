name: Update Release Badge

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  update-badge:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          ref: main

      - name: Get version from tag
        id: get_version
        run: echo "VERSION=${GITHUB_REF_NAME#v}" >> "$GITHUB_ENV"

      - name: Update README.md
        run: |
          sed -i "s/badge\/Version-.*-green/badge\/Version-${{ env.VERSION }}-green/" README.md

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v8
        with:
          commit-message: "docs: Update release badge to version ${{ env.VERSION }}"
          title: "docs: Update release badge to version ${{ env.VERSION }}"
          body: |
            Automated PR to update the version badge in README.md to `${{ env.VERSION }}`.

            Triggered by tag: `${{ github.ref_name }}`
          branch: docs/update-badge-${{ env.VERSION }}
          delete-branch: true
          labels: documentation,automated
